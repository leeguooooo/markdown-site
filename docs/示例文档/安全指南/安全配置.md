# 安全配置指南

## 🛡️ 安全特性概览

本系统实施了多层安全防护措施，确保文档系统的安全性和稳定性。

## 🔐 认证与授权

### JWT 认证
- 使用 JWT (JSON Web Token) 进行无状态认证
- Token 有效期：24小时
- 支持自动刷新机制

### 密码安全
- 使用 bcrypt 进行密码哈希（12轮加密）
- 支持强密码策略
- 防止密码暴力破解

## 🚫 文件系统安全

### 路径验证
- 严格的路径遍历防护
- 禁止访问系统目录
- 路径规范化处理

### 文件类型限制
- 仅允许 `.md` 和 `.txt` 文件
- 文件扩展名验证
- 内容类型检查

### 文件大小限制
- 单文件最大 1MB
- 总上传大小限制
- 防止存储空间滥用

## 🔄 速率限制

### API 速率限制
- 认证 API：15分钟内最多5次尝试
- 文件操作：1分钟内最多10次
- 一般 API：1分钟内最多60次

### 实现机制
- 基于 IP 地址的限制
- 内存存储（生产环境建议使用 Redis）
- 自动清理过期记录

## 📝 输入验证

### 文件名验证
- 禁止特殊字符：`<>:"/\|?*`
- 长度限制：1-200字符
- 保留名称检查
- Unicode 字符支持

### 内容验证
- 文本内容检查
- 二进制内容拒绝
- XSS 防护
- 恶意代码检测

## 🔍 安全监控

### 日志记录
- 认证失败记录
- 文件操作日志
- 安全事件追踪
- IP 地址记录

### 错误处理
- 安全的错误消息
- 避免信息泄露
- 统一错误格式
- 详细的内部日志

## 🌐 网络安全

### CORS 配置
- 严格的跨域策略
- Origin 验证
- Referer 检查
- 预检请求处理

### Headers 安全
- Content-Type 验证
- User-Agent 检查
- 自定义头部过滤
- 请求大小限制

## 🔧 生产环境配置

### 环境变量
```bash
# JWT 密钥（必须设置强随机字符串）
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# 管理员密码哈希
ADMIN_PASSWORD_HASH=$2a$12$...

# 基础 URL
NEXT_PUBLIC_BASE_URL=https://your-domain.com

# 环境标识
NODE_ENV=production
```

### 服务器配置
- 使用 HTTPS
- 设置安全头部
- 配置防火墙
- 定期安全更新

## 🚨 安全建议

### 密码策略
1. 使用强密码（至少12位）
2. 包含大小写字母、数字、特殊字符
3. 定期更换密码
4. 避免使用常见密码

### 部署安全
1. 使用 HTTPS 协议
2. 配置 CSP 头部
3. 启用 HSTS
4. 设置 X-Frame-Options

### 监控建议
1. 定期检查日志
2. 监控异常访问
3. 设置告警机制
4. 备份重要数据

## 🔄 安全更新

### 依赖管理
- 定期更新依赖包
- 扫描安全漏洞
- 使用 npm audit
- 监控安全公告

### 代码审查
- 定期安全审计
- 代码质量检查
- 渗透测试
- 第三方安全评估

## 📞 安全事件响应

### 发现安全问题
1. 立即隔离受影响系统
2. 收集相关日志和证据
3. 评估影响范围
4. 制定修复计划

### 联系方式
- 安全邮箱：security@your-domain.com
- 紧急联系：+86-xxx-xxxx-xxxx
- GitHub Issues：安全相关问题

## 🔍 安全检查清单

### 部署前检查
- [ ] 更改默认密码
- [ ] 设置强 JWT 密钥
- [ ] 配置 HTTPS
- [ ] 设置防火墙规则
- [ ] 启用日志记录

### 运行时检查
- [ ] 监控异常访问
- [ ] 检查错误日志
- [ ] 验证备份完整性
- [ ] 更新安全补丁
- [ ] 审查用户权限

---

**注意**：安全是一个持续的过程，需要定期评估和改进。建议定期进行安全审计和渗透测试。
